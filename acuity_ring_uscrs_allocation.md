# US-CRS Based Heart Allocation Classifications

This document defines all 68 allocation classifications for the counterfactual US-CRS based heart allocation system, replacing the therapy-based 6-status system with US-CRS score ranges.

## US-CRS Status Definitions
- **Status 1**: US-CRS ≥ 49
- **Status 2**: US-CRS 40-49  
- **Status 3**: US-CRS 30-39
- **Status 4**: US-CRS 20-29
- **Status 5**: US-CRS 10-19
- **Status 6**: US-CRS 0-9

## Distance Categories
- **250NM**: ≤ 250 nautical miles
- **500NM**: > 250 and ≤ 500 nautical miles
- **1000NM**: > 500 and ≤ 1000 nautical miles
- **1500NM**: > 1000 and ≤ 1500 nautical miles
- **2500NM**: > 1500 and ≤ 2500 nautical miles
- **Nation**: > 2500 nautical miles

## Blood Type Compatibility
- **Primary Match**: 
  - Donor O → Recipient O, B
  - Donor A → Recipient A, AB
  - Donor B → Recipient B, AB
  - Donor AB → Recipient AB
- **Secondary Match**:
  - Donor O → Recipient A, AB

---

# Table 6-7: Allocation of Hearts from Deceased Donors At Least 18 Years Old

## Classifications 1-68 (Adult Donors ≥18 years)

| Class | Candidates | Blood Match | Distance | US-CRS Status |
|-------|------------|-------------|----------|---------------|
| 1 | Adult US-CRS Status 1 or pediatric Status 1A | Primary | 500NM | ≥49 |
| 2 | Adult US-CRS Status 1 or pediatric Status 1A | Secondary | 500NM | ≥49 |
| 3 | Adult US-CRS Status 2 | Primary | 500NM | 40-49 |
| 4 | Adult US-CRS Status 2 | Secondary | 500NM | 40-49 |
| 5 | Adult US-CRS Status 3 or pediatric Status 1B | Primary | 250NM | 30-39 |
| 6 | Adult US-CRS Status 3 or pediatric Status 1B | Secondary | 250NM | 30-39 |
| 7 | Adult US-CRS Status 1 or pediatric Status 1A | Primary | 1000NM | ≥49 |
| 8 | Adult US-CRS Status 1 or pediatric Status 1A | Secondary | 1000NM | ≥49 |
| 9 | Adult US-CRS Status 2 | Primary | 1000NM | 40-49 |
| 10 | Adult US-CRS Status 2 | Secondary | 1000NM | 40-49 |
| 11 | Adult US-CRS Status 4 | Primary | 250NM | 20-29 |
| 12 | Adult US-CRS Status 4 | Secondary | 250NM | 20-29 |
| 13 | Adult US-CRS Status 3 or pediatric Status 1B | Primary | 500NM | 30-39 |
| 14 | Adult US-CRS Status 3 or pediatric Status 1B | Secondary | 500NM | 30-39 |
| 15 | Adult US-CRS Status 5 | Primary | 250NM | 10-19 |
| 16 | Adult US-CRS Status 5 | Secondary | 250NM | 10-19 |
| 17 | Adult US-CRS Status 3 or pediatric Status 1B | Primary | 1000NM | 30-39 |
| 18 | Adult US-CRS Status 3 or pediatric Status 1B | Secondary | 1000NM | 30-39 |
| 19 | Adult US-CRS Status 6 or pediatric Status 2 | Primary | 250NM | 0-9 |
| 20 | Adult US-CRS Status 6 or pediatric Status 2 | Secondary | 250NM | 0-9 |
| 21 | Adult US-CRS Status 1 or pediatric Status 1A | Primary | 1500NM | ≥49 |
| 22 | Adult US-CRS Status 1 or pediatric Status 1A | Secondary | 1500NM | ≥49 |
| 23 | Adult US-CRS Status 2 | Primary | 1500NM | 40-49 |
| 24 | Adult US-CRS Status 2 | Secondary | 1500NM | 40-49 |
| 25 | Adult US-CRS Status 3 or pediatric Status 1B | Primary | 1500NM | 30-39 |
| 26 | Adult US-CRS Status 3 or pediatric Status 1B | Secondary | 1500NM | 30-39 |
| 27 | Adult US-CRS Status 4 | Primary | 500NM | 20-29 |
| 28 | Adult US-CRS Status 4 | Secondary | 500NM | 20-29 |
| 29 | Adult US-CRS Status 5 | Primary | 500NM | 10-19 |
| 30 | Adult US-CRS Status 5 | Secondary | 500NM | 10-19 |
| 31 | Adult US-CRS Status 6 or pediatric Status 2 | Primary | 500NM | 0-9 |
| 32 | Adult US-CRS Status 6 or pediatric Status 2 | Secondary | 500NM | 0-9 |
| 33 | Adult US-CRS Status 1 or pediatric Status 1A | Primary | 2500NM | ≥49 |
| 34 | Adult US-CRS Status 1 or pediatric Status 1A | Secondary | 2500NM | ≥49 |
| 35 | Adult US-CRS Status 2 | Primary | 2500NM | 40-49 |
| 36 | Adult US-CRS Status 2 | Secondary | 2500NM | 40-49 |
| 37 | Adult US-CRS Status 3 or pediatric Status 1B | Primary | 2500NM | 30-39 |
| 38 | Adult US-CRS Status 3 or pediatric Status 1B | Secondary | 2500NM | 30-39 |
| 39 | Adult US-CRS Status 4 | Primary | 1000NM | 20-29 |
| 40 | Adult US-CRS Status 4 | Secondary | 1000NM | 20-29 |
| 41 | Adult US-CRS Status 5 | Primary | 1000NM | 10-19 |
| 42 | Adult US-CRS Status 5 | Secondary | 1000NM | 10-19 |
| 43 | Adult US-CRS Status 6 or pediatric Status 2 | Primary | 1000NM | 0-9 |
| 44 | Adult US-CRS Status 6 or pediatric Status 2 | Secondary | 1000NM | 0-9 |
| 45 | Adult US-CRS Status 1 or pediatric Status 1A | Primary | Nation | ≥49 |
| 46 | Adult US-CRS Status 1 or pediatric Status 1A | Secondary | Nation | ≥49 |
| 47 | Adult US-CRS Status 2 | Primary | Nation | 40-49 |
| 48 | Adult US-CRS Status 2 | Secondary | Nation | 40-49 |
| 49 | Adult US-CRS Status 3 or pediatric Status 1B | Primary | Nation | 30-39 |
| 50 | Adult US-CRS Status 3 or pediatric Status 1B | Secondary | Nation | 30-39 |
| 51 | Adult US-CRS Status 4 | Primary | 1500NM | 20-29 |
| 52 | Adult US-CRS Status 4 | Secondary | 1500NM | 20-29 |
| 53 | Adult US-CRS Status 5 | Primary | 1500NM | 10-19 |
| 54 | Adult US-CRS Status 5 | Secondary | 1500NM | 10-19 |
| 55 | Adult US-CRS Status 6 or pediatric Status 2 | Primary | 1500NM | 0-9 |
| 56 | Adult US-CRS Status 6 or pediatric Status 2 | Secondary | 1500NM | 0-9 |
| 57 | Adult US-CRS Status 4 | Primary | 2500NM | 20-29 |
| 58 | Adult US-CRS Status 4 | Secondary | 2500NM | 20-29 |
| 59 | Adult US-CRS Status 5 | Primary | 2500NM | 10-19 |
| 60 | Adult US-CRS Status 5 | Secondary | 2500NM | 10-19 |
| 61 | Adult US-CRS Status 6 or pediatric Status 2 | Primary | 2500NM | 0-9 |
| 62 | Adult US-CRS Status 6 or pediatric Status 2 | Secondary | 2500NM | 0-9 |
| 63 | Adult US-CRS Status 4 | Primary | Nation | 20-29 |
| 64 | Adult US-CRS Status 4 | Secondary | Nation | 20-29 |
| 65 | Adult US-CRS Status 5 | Primary | Nation | 10-19 |
| 66 | Adult US-CRS Status 5 | Secondary | Nation | 10-19 |
| 67 | Adult US-CRS Status 6 or pediatric Status 2 | Primary | Nation | 0-9 |
| 68 | Adult US-CRS Status 6 or pediatric Status 2 | Secondary | Nation | 0-9 |

---

# Table 6-8: Allocation of Hearts from Donors Less Than 18 Years Old

## Overview

Pediatric donors (<18 years) follow a **pediatric-first allocation sequence** that prioritizes pediatric candidates before adult candidates within each geographic and blood type combination. This preserves pediatric organs for pediatric recipients whenever possible while still allowing adult candidates to receive pediatric donor organs when no suitable pediatric candidates are available.

## Key Differences from Adult Donor Allocation

1. **Pediatric Priority**: Pediatric candidates (Status 1A, 1B, 2) receive priority over equivalent adult US-CRS statuses
2. **Age-Appropriate Matching**: Pediatric donors preferentially go to pediatric recipients  
3. **Mixed Classification**: Each distance/blood type combination includes both pediatric and adult candidates
4. **Status Mapping**: Pediatric Status 1A ≈ Adult US-CRS Status 1, but pediatric candidates get priority

## Pediatric Status Equivalencies

| Pediatric Status | Approximate Adult US-CRS Equivalent | Priority Notes |
|------------------|-------------------------------------|----------------|
| **Status 1A** | US-CRS ≥49 (Status 1) | Pediatric 1A ranked before Adult Status 1 |
| **Status 1B** | US-CRS 30-39 (Status 3) | Pediatric 1B ranked before Adult Status 3 |  
| **Status 2** | US-CRS 0-9 (Status 6) | Pediatric 2 ranked before Adult Status 6 |

## Classifications 69-172 (Pediatric Donors <18 years)

| Class | Candidates | Blood Match | Distance | US-CRS Status |
|-------|------------|-------------|----------|---------------|
| 69 | Pediatric Status 1A | Primary | 500NM | Status 1A |
| 70 | Pediatric Status 1A | Secondary | 500NM | Status 1A |
| 71 | Adult US-CRS Status 1 | Primary | 500NM | ≥49 |
| 72 | Adult US-CRS Status 1 | Secondary | 500NM | ≥49 |
| 73 | Pediatric Status 1B | Primary | 250NM | Status 1B |
| 74 | Pediatric Status 1B | Secondary | 250NM | Status 1B |
| 75 | Adult US-CRS Status 2 | Primary | 250NM | 40-49 |
| 76 | Adult US-CRS Status 2 | Secondary | 250NM | 40-49 |
| 77 | Pediatric Status 1A | Primary | 1000NM | Status 1A |
| 78 | Pediatric Status 1A | Secondary | 1000NM | Status 1A |
| 79 | Adult US-CRS Status 1 | Primary | 1000NM | ≥49 |
| 80 | Adult US-CRS Status 1 | Secondary | 1000NM | ≥49 |
| 81 | Pediatric Status 1B | Primary | 500NM | Status 1B |
| 82 | Pediatric Status 1B | Secondary | 500NM | Status 1B |
| 83 | Adult US-CRS Status 2 | Primary | 500NM | 40-49 |
| 84 | Adult US-CRS Status 2 | Secondary | 500NM | 40-49 |
| 85 | Pediatric Status 2 | Primary | 250NM | Status 2 |
| 86 | Pediatric Status 2 | Secondary | 250NM | Status 2 |
| 87 | Adult US-CRS Status 3 | Primary | 250NM | 30-39 |
| 88 | Adult US-CRS Status 3 | Secondary | 250NM | 30-39 |
| 89 | Pediatric Status 1A | Primary | 1500NM | Status 1A |
| 90 | Pediatric Status 1A | Secondary | 1500NM | Status 1A |
| 91 | Adult US-CRS Status 1 | Primary | 1500NM | ≥49 |
| 92 | Adult US-CRS Status 1 | Secondary | 1500NM | ≥49 |
| 93 | Pediatric Status 1B | Primary | 1000NM | Status 1B |
| 94 | Pediatric Status 1B | Secondary | 1000NM | Status 1B |
| 95 | Adult US-CRS Status 2 | Primary | 1000NM | 40-49 |
| 96 | Adult US-CRS Status 2 | Secondary | 1000NM | 40-49 |
| 97 | Pediatric Status 2 | Primary | 500NM | Status 2 |
| 98 | Pediatric Status 2 | Secondary | 500NM | Status 2 |
| 99 | Adult US-CRS Status 3 | Primary | 500NM | 30-39 |
| 100 | Adult US-CRS Status 3 | Secondary | 500NM | 30-39 |
| 101 | Adult US-CRS Status 4 | Primary | 250NM | 20-29 |
| 102 | Adult US-CRS Status 4 | Secondary | 250NM | 20-29 |
| 103 | Pediatric Status 1A | Primary | 2500NM | Status 1A |
| 104 | Pediatric Status 1A | Secondary | 2500NM | Status 1A |
| 105 | Adult US-CRS Status 1 | Primary | 2500NM | ≥49 |
| 106 | Adult US-CRS Status 1 | Secondary | 2500NM | ≥49 |
| 107 | Pediatric Status 1B | Primary | 1500NM | Status 1B |
| 108 | Pediatric Status 1B | Secondary | 1500NM | Status 1B |
| 109 | Adult US-CRS Status 2 | Primary | 1500NM | 40-49 |
| 110 | Adult US-CRS Status 2 | Secondary | 1500NM | 40-49 |
| 111 | Pediatric Status 2 | Primary | 1000NM | Status 2 |
| 112 | Pediatric Status 2 | Secondary | 1000NM | Status 2 |
| 113 | Adult US-CRS Status 3 | Primary | 1000NM | 30-39 |
| 114 | Adult US-CRS Status 3 | Secondary | 1000NM | 30-39 |
| 115 | Adult US-CRS Status 4 | Primary | 500NM | 20-29 |
| 116 | Adult US-CRS Status 4 | Secondary | 500NM | 20-29 |
| 117 | Adult US-CRS Status 5 | Primary | 250NM | 10-19 |
| 118 | Adult US-CRS Status 5 | Secondary | 250NM | 10-19 |
| 119 | Pediatric Status 1A | Primary | Nation | Status 1A |
| 120 | Pediatric Status 1A | Secondary | Nation | Status 1A |
| 121 | Adult US-CRS Status 1 | Primary | Nation | ≥49 |
| 122 | Adult US-CRS Status 1 | Secondary | Nation | ≥49 |
| 123 | Pediatric Status 1B | Primary | 2500NM | Status 1B |
| 124 | Pediatric Status 1B | Secondary | 2500NM | Status 1B |
| 125 | Adult US-CRS Status 2 | Primary | 2500NM | 40-49 |
| 126 | Adult US-CRS Status 2 | Secondary | 2500NM | 40-49 |
| 127 | Pediatric Status 2 | Primary | 1500NM | Status 2 |
| 128 | Pediatric Status 2 | Secondary | 1500NM | Status 2 |
| 129 | Adult US-CRS Status 3 | Primary | 1500NM | 30-39 |
| 130 | Adult US-CRS Status 3 | Secondary | 1500NM | 30-39 |
| 131 | Adult US-CRS Status 4 | Primary | 1000NM | 20-29 |
| 132 | Adult US-CRS Status 4 | Secondary | 1000NM | 20-29 |
| 133 | Adult US-CRS Status 5 | Primary | 500NM | 10-19 |
| 134 | Adult US-CRS Status 5 | Secondary | 500NM | 10-19 |
| 135 | Adult US-CRS Status 6 | Primary | 250NM | 0-9 |
| 136 | Adult US-CRS Status 6 | Secondary | 250NM | 0-9 |
| 137 | Pediatric Status 1B | Primary | Nation | Status 1B |
| 138 | Pediatric Status 1B | Secondary | Nation | Status 1B |
| 139 | Adult US-CRS Status 2 | Primary | Nation | 40-49 |
| 140 | Adult US-CRS Status 2 | Secondary | Nation | 40-49 |
| 141 | Pediatric Status 2 | Primary | 2500NM | Status 2 |
| 142 | Pediatric Status 2 | Secondary | 2500NM | Status 2 |
| 143 | Adult US-CRS Status 3 | Primary | 2500NM | 30-39 |
| 144 | Adult US-CRS Status 3 | Secondary | 2500NM | 30-39 |
| 145 | Adult US-CRS Status 4 | Primary | 1500NM | 20-29 |
| 146 | Adult US-CRS Status 4 | Secondary | 1500NM | 20-29 |
| 147 | Adult US-CRS Status 5 | Primary | 1000NM | 10-19 |
| 148 | Adult US-CRS Status 5 | Secondary | 1000NM | 10-19 |
| 149 | Adult US-CRS Status 6 | Primary | 500NM | 0-9 |
| 150 | Adult US-CRS Status 6 | Secondary | 500NM | 0-9 |
| 151 | Pediatric Status 2 | Primary | Nation | Status 2 |
| 152 | Pediatric Status 2 | Secondary | Nation | Status 2 |
| 153 | Adult US-CRS Status 3 | Primary | Nation | 30-39 |
| 154 | Adult US-CRS Status 3 | Secondary | Nation | 30-39 |
| 155 | Adult US-CRS Status 4 | Primary | 2500NM | 20-29 |
| 156 | Adult US-CRS Status 4 | Secondary | 2500NM | 20-29 |
| 157 | Adult US-CRS Status 5 | Primary | 1500NM | 10-19 |
| 158 | Adult US-CRS Status 5 | Secondary | 1500NM | 10-19 |
| 159 | Adult US-CRS Status 6 | Primary | 1000NM | 0-9 |
| 160 | Adult US-CRS Status 6 | Secondary | 1000NM | 0-9 |
| 161 | Adult US-CRS Status 4 | Primary | Nation | 20-29 |
| 162 | Adult US-CRS Status 4 | Secondary | Nation | 20-29 |
| 163 | Adult US-CRS Status 5 | Primary | 2500NM | 10-19 |
| 164 | Adult US-CRS Status 5 | Secondary | 2500NM | 10-19 |
| 165 | Adult US-CRS Status 6 | Primary | 1500NM | 0-9 |
| 166 | Adult US-CRS Status 6 | Secondary | 1500NM | 0-9 |
| 167 | Adult US-CRS Status 5 | Primary | Nation | 10-19 |
| 168 | Adult US-CRS Status 5 | Secondary | Nation | 10-19 |
| 169 | Adult US-CRS Status 6 | Primary | 2500NM | 0-9 |
| 170 | Adult US-CRS Status 6 | Secondary | 2500NM | 0-9 |
| 171 | Adult US-CRS Status 6 | Primary | Nation | 0-9 |
| 172 | Adult US-CRS Status 6 | Secondary | Nation | 0-9 |

---

## Pediatric Allocation Pattern Analysis

### Geographic Progression by Status

**Pediatric Status 1A** (Highest Priority):
- Classes 69-70: 500NM (Primary/Secondary)
- Classes 77-78: 1000NM (Primary/Secondary) 
- Classes 89-90: 1500NM (Primary/Secondary)
- Classes 103-104: 2500NM (Primary/Secondary)
- Classes 119-120: Nation (Primary/Secondary)

**Pediatric Status 1B** (High Priority):
- Classes 73-74: 250NM (Primary/Secondary)
- Classes 81-82: 500NM (Primary/Secondary)
- Classes 93-94: 1000NM (Primary/Secondary)
- Classes 107-108: 1500NM (Primary/Secondary)  
- Classes 123-124: 2500NM (Primary/Secondary)
- Classes 137-138: Nation (Primary/Secondary)

**Pediatric Status 2** (Lower Priority):
- Classes 85-86: 250NM (Primary/Secondary)
- Classes 97-98: 500NM (Primary/Secondary)
- Classes 111-112: 1000NM (Primary/Secondary)
- Classes 127-128: 1500NM (Primary/Secondary)
- Classes 141-142: 2500NM (Primary/Secondary)
- Classes 151-152: Nation (Primary/Secondary)

### Adult Candidate Integration

Adult candidates are interspersed throughout the pediatric donor allocation sequence based on their US-CRS scores:

- **Adult Status 1** (US-CRS ≥49): Follows Pediatric Status 1A in each distance circle
- **Adult Status 2** (US-CRS 40-49): Follows Pediatric Status 1B initially, then by distance
- **Adult Status 3** (US-CRS 30-39): Follows Pediatric Status 2 initially, then by distance  
- **Adult Status 4-6** (US-CRS <30): Fill remaining classifications by distance priority

### Implementation Considerations

1. **Pediatric Candidate Identification**: 
   - Age <18 years OR
   - Adult candidates with pediatric status codes (2010, 2020, 2030)

2. **US-CRS Score Assignment for Pediatric Candidates**:
   - Use adult US-CRS model if available
   - Otherwise, impute based on pediatric status equivalencies
   - Status 1A → Imputed US-CRS ≥49
   - Status 1B → Imputed US-CRS ~35 (mid-range of 30-39)
   - Status 2 → Imputed US-CRS ~5 (mid-range of 0-9)

3. **Tie-Breaking for Pediatric Candidates**:
   - Primary: Pediatric status level (1A > 1B > 2)
   - Secondary: US-CRS score (if available)
   - Tertiary: Waiting time
   - Final: Raw survival probability (prob_surv_6wk)

## Tie-Breaking Within Classifications

Within each classification, candidates are ranked by:
1. **US-CRS Score** (higher score = higher priority)
2. **Raw Probability Score** (`prob_surv_6wk`, lower probability = higher priority, for exact tie-breaking)
3. **Waiting Time** (longer waiting time = higher priority, if needed)

---

## Implementation Notes

### General Implementation
- Adult candidates with pediatric status codes (2010, 2020, 2030) should be treated as pediatric for allocation purposes
- US-CRS scores for pediatric candidates without adult US-CRS data should be imputed based on their current status
- Blood type incompatible matches are excluded from allocation
- Distance is calculated in nautical miles from donor hospital to candidate transplant center

### Pediatric Donor Specific Implementation

**Donor Age Classification**:
```r
donor_age_category <- ifelse(DON_AGE < 18, "pediatric", "adult")
allocation_table <- ifelse(donor_age_category == "pediatric", "Table_6_8", "Table_6_7")
```

**Candidate Classification for Pediatric Donors**:
```r
candidate_type <- case_when(
  str_detect(status, "pediatric") ~ "pediatric",
  PTR_STAT_CD %in% c("2010", "2020", "2030") ~ "pediatric",
  CAN_AGE_AT_LISTING < 18 ~ "pediatric", 
  TRUE ~ "adult"
)
```

**Priority Ranking Algorithm**:
1. Filter to blood type compatible candidates
2. Calculate distance category (250NM, 500NM, 1000NM, 1500NM, 2500NM, Nation)
3. Assign classification (1-172) based on Table 6-8
4. Within each classification, rank by:
   - Pediatric status level (if pediatric candidate)
   - US-CRS score (higher = better priority)
   - Raw survival probability (lower = better priority) 
   - Waiting time (longer = better priority)

**Code Structure**:
```r
assign_pediatric_donor_classification <- function(match_data) {
  match_data %>%
    filter(DON_AGE < 18) %>%
    mutate(
      candidate_type = determine_candidate_type(...),
      blood_compatibility = is_blood_compatible(DON_ABO, CAN_ABO, "heart"),
      distance_category = get_distance_category(PTR_DISTANCE),
      us_crs_status = map_uscrs_status(us_crs_score),
      allocation_class = assign_class_69_172(...)
    ) %>%
    arrange(allocation_class, desc(us_crs_score), desc(prob_surv_6wk))
}
```

### Validation Checks

- Verify pediatric candidates receive appropriate priority within classifications
- Ensure adult candidates are correctly interspersed based on US-CRS equivalencies  
- Confirm distance circles are applied consistently across pediatric and adult donor allocations
- Test edge cases: pediatric candidates with adult status codes, adult candidates competing for pediatric donor organs